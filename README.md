# 🎵 音乐下载助手

一站式「搜索歌单、试听、批量下载」工具。前端完成打包，服务器只负责API与静态资源，做到零中转、零流量压力，和你的网站实际功能完全一致。

## ✨ 功能特性（与站点一致）

- **首页热榜**: 展示热门歌单卡片，点击即进详情（数据源：`/api/playlist/hot`）
- **歌单搜索**: 支持顶部搜索和首页居中搜索，结果列表卡片式展示
- **歌单详情**: Spotify 风格大封面背景、创建者、曲目数、描述等
- **在线播放器**: 底部播放器支持播放/暂停、上一首/下一首、进度拖动、音量调节、移动端自适应简化
- **VIP识别**: 依据 `fee` 字段标记 VIP/付费/试听，UI 红标签提示
- **多选与批量**: 全选/取消全选，红色角标动态显示已选数量
- **客户端打包**: 浏览器端直连网易云CDN下载，使用 JSZip 在本地打包 ZIP
- **实时反馈**: 进度条、详细日志、成功/失败/跳过统计
- **哈希路由**: 书签可分享，支持 `#/search/:keyword` 与 `#/playlist/:id`

提示：VIP/付费歌曲在未登录会员场景下通常仅能获取试听版（约30秒），界面与日志会明确标注。

## 🚀 快速开始

### 环境要求
- Node.js 16+（推荐 18+）

### 安装依赖
```bash
npm install
```

### 启动服务
```bash
npm start
```

启动成功后访问 `http://localhost:3000`。

若遇到端口占用，可先清理 3000 端口：
```bash
lsof -ti:3000 | xargs kill -9 2>/dev/null || true
```
以上做法是我们一贯的标准流程，避免端口冲突导致的假失败 [[memory:10292525]]。

### 开发模式
```bash
npm run dev
```
支持热重启（nodemon）。

## 🧭 使用指引（站点交互一一对应）

1) 首页
- 顶部导航在首页隐藏，居中搜索框更聚焦；下方展示热门歌单卡片（点击进入详情）。

2) 搜索
- 顶部或首页输入关键词并回车/点击放大镜；结果以卡片列表展示，包含封面、标题、创建者、歌曲数。

3) 歌单详情
- 头部大图背景+渐变遮罩；左侧封面、右侧标题/作者/数量/描述。
- 列表支持勾选、全选/取消全选；右侧播放按钮可直接试听单曲。

4) 播放器
- 底部悬浮播放器，显示封面、歌名、歌手；支持播放/暂停、跳曲、进度拖动、音量调整；移动端针对性简化控件。

5) 批量下载
- 勾选歌曲后点击“下载”，浏览器逐首直连获取音频，完成后在本地打包为 ZIP 并触发保存。
- 日志面板同步显示进度与每首结果，失败会给出原因；VIP/付费歌曲会提示“试听版30秒”。

更多细节：
- [使用指南.md](./使用指南.md)
- [播放器使用说明.md](./播放器使用说明.md)
- [VIP歌曲说明.md](./VIP歌曲说明.md)

## 🛠 技术与架构

- **后端（Express）**: 提供静态资源与网易云 API 封装，不中转音频流。
- **前端（原生 JS）**: 使用 Fetch 与 JSZip 完成数据获取与本地打包；CSS 采用 Spotify 风格，移动端自适配。
- **本地库原则**: 第三方库本地托管，避免引入外部 CDN 带来的不稳定性 [[memory:10292620]]。

### 技术亮点（客户端打包）
- 服务器零流量/零性能开销，极致扩展性；直连 CDN，速度更快；弱机也能承载高并发。
对比服务端打包的成本与瓶颈，详见：[技术方案对比.md](./技术方案对比.md)

## 🔌 API 文档（实际可用）

所有接口均为 GET：

- /api/playlist/hot
  - 用途: 获取热门歌单（首页推荐）
  - 参数: `cat`(默认“全部”) `limit`(默认20) `offset`(默认0)
  - 返回: 网易云原始结构（含 `playlists`）

- /api/search/playlist
  - 用途: 搜索歌单
  - 参数: `keywords`(必填) `limit` `offset`
  - 返回: 网易云原始结构（`result.playlists`）

- /api/playlist/detail
  - 用途: 获取歌单详情与曲目
  - 参数: `id`(必填)
  - 返回: `playlist`（含 `tracks`）

- /api/song/url
  - 用途: 批量获取歌曲直链
  - 参数: `ids`(必填，逗号分隔) `level`(默认 standard；可选 standard/higher/exhigh/lossless/hires...)
  - 返回: `data[ { id, url, br, ... } ]`

- /api/song/detail
  - 用途: 获取歌曲详情
  - 参数: `ids`(必填，逗号分隔)
  - 返回: `songs[ ]`

说明：站内试听默认尝试 `exhigh`，批量下载使用接口返回的可用直链，失败会在日志中标注并跳过。

## 🧱 前端路由（Hash）

- 主页: `#/` 或空 hash（会隐藏顶部搜索条）
- 搜索: `#/search/:keyword`
- 歌单: `#/playlist/:id`

可直接分享上述地址，刷新后可自动恢复页面状态。

## 📦 数据与业务规则

- `fee` 含义: 0 免费，1 VIP，4 付费专辑，8 低音质免费；VIP/付费会标“VIP/付费/试听”。
- 文件名规范: `歌手 - 歌名.mp3`，自动清理非法字符。
- 图片优化: 通过 `?param=WxH` 请求缩略图（如 `200x200`）以降低体积。
- 下载与打包: 浏览器串行下载每首歌后写入 ZIP（更稳定、内存友好）。

## ⚙️ 部署与运维

- 默认端口 3000，可通过反向代理暴露服务；静态文件可结合缓存策略提升命中率。
- 若端口被占用，先清理进程再启动，避免多实例冲突 [[memory:10292525]]。
- 生产建议使用进程守护（如 pm2/systemd）。

## ❓常见问题（FAQ）

- 为什么有些歌曲没有直链/只能试听？
  - 版权与会员限制导致，接口会返回空 `url` 或仅提供试听版。

- 批量下载会很慢吗？
  - 串行策略更稳健；建议单次不超过 50 首，以平衡速度与稳定性。

- 下载的文件在哪里？
  - 浏览器默认下载目录；ZIP 文件名包含歌单名与时间戳。

- 403/429 报错？
  - 可能是网络或频率限制，稍候重试或减少请求量。

更多问题与技巧请参见：[使用指南.md](./使用指南.md)

## 📁 目录结构

```
music-download/
├── server.js            # Express 服务与 API 封装
├── package.json         # 脚本与依赖
├── public/              # 前端静态资源（本地托管，无 CDN）
│   ├── index.html       # 页面结构（首页/搜索/详情/播放器）
│   ├── style.css        # 主题样式（Spotify 风格，响应式）
│   ├── app.js           # 前端核心逻辑（路由、渲染、下载、播放器）
│   ├── jszip.min.js     # 本地 JSZip 库
│   └── remixicon.*      # 图标字体（本地）
├── README.md            # 本文档
├── 使用指南.md
├── 播放器使用说明.md
└── VIP歌曲说明.md
```

## ⚠️ 法律与合规

- 本项目仅供学习与交流，请勿用于商业或任何侵权用途；请支持正版音乐。
- 若涉及第三方版权，请遵循相应平台与法律法规。

## 📄 License

MIT

—— Made with ❤️ by 蓉儿 | 仅供学习交流使用

